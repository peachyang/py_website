
/*!
 * jQuery UI Droppable @VERSION
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/droppable/
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./core","./widget","./mouse","./draggable"],a)}else{a(jQuery)}}(function(a){a.widget("ui.droppable",{version:"@VERSION",widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var c,d=this.options,b=d.accept;this.isover=false;this.isout=true;this.accept=a.isFunction(b)?b:function(e){return e.is(b)};this.proportions=function(){if(arguments.length){c=arguments[0]}else{return c?c:c={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}}};this._addToManager(d.scope);d.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(b){a.ui.ddmanager.droppables[b]=a.ui.ddmanager.droppables[b]||[];a.ui.ddmanager.droppables[b].push(this)},_splice:function(b){var c=0;for(;c<b.length;c++){if(b[c]===this){b.splice(c,1)}}},_destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];this._splice(b);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(c,d){if(c==="accept"){this.accept=a.isFunction(d)?d:function(e){return e.is(d)}}else{if(c==="scope"){var b=a.ui.ddmanager.droppables[this.options.scope];this._splice(b);this._addToManager(d)}}this._super(c,d)},_activate:function(c){var b=a.ui.ddmanager.current;if(this.options.activeClass){this.element.addClass(this.options.activeClass)}if(b){this._trigger("activate",c,this.ui(b))}},_deactivate:function(c){var b=a.ui.ddmanager.current;if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}if(b){this._trigger("deactivate",c,this.ui(b))}},_over:function(c){var b=a.ui.ddmanager.current;if(!b||(b.currentItem||b.element)[0]===this.element[0]){return}if(this.accept.call(this.element[0],(b.currentItem||b.element))){if(this.options.hoverClass){this.element.addClass(this.options.hoverClass)}this._trigger("over",c,this.ui(b))}},_out:function(c){var b=a.ui.ddmanager.current;if(!b||(b.currentItem||b.element)[0]===this.element[0]){return}if(this.accept.call(this.element[0],(b.currentItem||b.element))){if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("out",c,this.ui(b))}},_drop:function(c,d){var b=d||a.ui.ddmanager.current,e=false;if(!b||(b.currentItem||b.element)[0]===this.element[0]){return false}this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var f=a(this).droppable("instance");if(f.options.greedy&&!f.options.disabled&&f.options.scope===b.options.scope&&f.accept.call(f.element[0],(b.currentItem||b.element))&&a.ui.intersect(b,a.extend(f,{offset:f.element.offset()}),f.options.tolerance,c)){e=true;return false}});if(e){return false}if(this.accept.call(this.element[0],(b.currentItem||b.element))){if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("drop",c,this.ui(b));return this.element}return false},ui:function(b){return{draggable:(b.currentItem||b.element),helper:b.helper,position:b.position,offset:b.positionAbs}}});a.ui.intersect=(function(){function b(d,c,e){return(d>=c)&&(d<(c+e))}return function(o,h,m,d){if(!h.offset){return false}var f=(o.positionAbs||o.position.absolute).left+o.margins.left,k=(o.positionAbs||o.position.absolute).top+o.margins.top,e=f+o.helperProportions.width,j=k+o.helperProportions.height,g=h.offset.left,n=h.offset.top,c=g+h.proportions().width,i=n+h.proportions().height;switch(m){case"fit":return(g<=f&&e<=c&&n<=k&&j<=i);case"intersect":return(g<f+(o.helperProportions.width/2)&&e-(o.helperProportions.width/2)<c&&n<k+(o.helperProportions.height/2)&&j-(o.helperProportions.height/2)<i);case"pointer":return b(d.pageY,n,h.proportions().height)&&b(d.pageX,g,h.proportions().width);case"touch":return((k>=n&&k<=i)||(j>=n&&j<=i)||(k<n&&j>i))&&((f>=g&&f<=c)||(e>=g&&e<=c)||(f<g&&e>c));default:return false}}})();a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,g){var d,c,b=a.ui.ddmanager.droppables[e.options.scope]||[],f=g?g.type:null,h=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(d=0;d<b.length;d++){if(b[d].options.disabled||(e&&!b[d].accept.call(b[d].element[0],(e.currentItem||e.element)))){continue}for(c=0;c<h.length;c++){if(h[c]===b[d].element[0]){b[d].proportions().height=0;continue droppablesLoop}}b[d].visible=b[d].element.css("display")!=="none";if(!b[d].visible){continue}if(f==="mousedown"){b[d]._activate.call(b[d],g)}b[d].offset=b[d].element.offset();b[d].proportions({width:b[d].element[0].offsetWidth,height:b[d].element[0].offsetHeight})}},drop:function(b,c){var d=false;a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){if(!this.options){return}if(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance,c)){d=this._drop.call(this,c)||d}if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(b.currentItem||b.element))){this.isout=true;this.isover=false;this._deactivate.call(this,c)}});return d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){if(!b.options.refreshPositions){a.ui.ddmanager.prepareOffsets(b,c)}})},drag:function(b,c){if(b.options.refreshPositions){a.ui.ddmanager.prepareOffsets(b,c)}a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible){return}var g,e,d,f=a.ui.intersect(b,this,this.options.tolerance,c),h=!f&&this.isover?"isout":(f&&!this.isover?"isover":null);if(!h){return}if(this.options.greedy){e=this.options.scope;d=this.element.parents(":data(ui-droppable)").filter(function(){return a(this).droppable("instance").options.scope===e});if(d.length){g=a(d[0]).droppable("instance");g.greedyChild=(h==="isover")}}if(g&&h==="isover"){g.isover=false;g.isout=true;g._out.call(g,c)}this[h]=true;this[h==="isout"?"isover":"isout"]=false;this[h==="isover"?"_over":"_out"].call(this,c);if(g&&h==="isout"){g.isout=false;g.isover=true;g._over.call(g,c)}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable");if(!b.options.refreshPositions){a.ui.ddmanager.prepareOffsets(b,c)}}};return a.ui.droppable}));