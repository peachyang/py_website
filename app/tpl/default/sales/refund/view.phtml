<?php
$application = $this->getVariable('model');
$order = $application->getOrder();
$currency = $this->getCurrency();
?>
<div class="refund-detail">
    <ul class="nav nav-tabs">
        <li role="presentation" class="active"><a href="#products" data-toggle="tab"><?php echo $this->translate('Product Infomation') ?></a></li>
        <li role="presentation"><a href="#address" data-toggle="tab"><?php echo $this->translate('Shipping Address') ?></a></li>
    </ul>
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane fade in active" id="products">
            <table class="table table-no-border">
                <thead>
                    <tr class="text-nowrap">
                        <th class="text-left" colspan="2"><?php echo $this->translate('Product Infomation') ?></th>
                        <th class="text-center"><?php echo $this->translate('Price') ?></th>
                        <th class="text-center"><?php echo $this->translate('Refund Qty') ?></th>
                        <th class="text-center"><?php echo $this->translate('Detail') ?></th>
                        <th class="text-center"><?php echo $this->translate('Total') ?></th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="refund-store">
                        <td colspan="2"><?php echo $order->getStore()['name'] ?></td>
                        <td class="text-right" colspan="4"><?php echo $this->translate('Order ID'), ':', $order->offsetGet('increment_id') ?></td>
                    </tr>
                    <?php
                    $items = $application->getItems();
                    $flag = true;
                    foreach ($items as $item):
                        $product = $item['product'];
                        $thumbnail = $product->getThumbnail();
                        ?>
                    <tr class="refund-list">
                            <td>
                                <img src="<?php echo strpos($thumbnail, '//') ? $thumbnail : $this->getResourceUrl('image/resized/100x/' . $thumbnail) ?>" alt="<?php echo $product['name'] ?>" width="100" height="100" />
                            </td>
                            <td>
                                <h4 class="product-name"><?php echo $product['name'] ?></h4>
                                <?php
                                $options = json_decode($item['options'], true);
                                if ($item['product_id'] && count($options)):
                                    ?>
                                    <dl class="options">
                                        <?php
                                        foreach ($product->getOptions() as $option):
                                            if (isset($options[$option->getId()])):
                                                ?>
                                                <dt><?php echo $option['title'] ?></dt>
                                                <dd>
                                                    <?php
                                                    echo (in_array($option['input'], ['select', 'radio', 'checkbox', 'multiselect']) ?
                                                            $option->getValue($options[$option->getId()]) : $options[$option->getId()])
                                                    ?>
                                                </dd>
                                                <?php
                                            endif;
                                        endforeach;
                                        ?>
                                    </dl>
                                <?php endif ?>
                            </td>
                            <td class="text-center"><?php echo $currency->convert($item['base_price'], true) ?></td>
                            <td class="text-center"><?php echo (float) $item['qty'] ?></td>
                            <?php if ($flag): ?>
                                <td class="text-center detail" rowspan="<?php echo count($items) ?>">
                                    <span><?php echo $this->translate($this->getService($application['service'])) ?></span>
                                    <span><?php echo $this->translate($this->getStatus($application['status'])) ?></span>
                                    <span><?php echo date('Y-m-d<\b\r />H:i:s',strtotime($application['created_at'])) ?></span>
                                </td>
                                <td class="text-center amount" rowspan="<?php echo count($items) ?>"><?php echo $currency->convert($application['amount'], true) ?></td>
                                <?php
                                $flag = false;
                            endif;
                            ?>
                        </tr>
                    <?php endforeach ?>
                </tbody>
            </table>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="address">
            <?php echo nl2br($order['shipping_address']) ?>
        </div>
    </div>
    <div class="handler">
        
    </div>
    <div class="flow">
        
    </div>
    <div class="record">
        
    </div>
</div>
